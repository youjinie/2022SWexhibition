<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">

    <script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=usxa85bak8"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

    <link href="search.css" type="text/css" rel="stylesheet">
    <!--ÌéòÏù¥ÏßÄ ÌÉÄÏù¥ÌãÄ ÏïÑÏù¥ÏΩò ÏÇΩÏûÖ-->
    <link rel="shortcut icon" type="image/x-icon" href="./img/logo.png">
    <title>Ïñ¥Ïùò | ÏïΩÍµ≠ Í≤ÄÏÉâ</title>
</head>

<body>
    <!--ÏÇ¨Ïù¥Ìä∏ Î™Ö, ÌôàÎ≤ÑÌäº, Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ-->
    <header>
        <div class="title_main">
            <div id="title_bg">
                <div class="title_bar">
                    <form>
                        <!--onClick Ï∂îÍ∞Ä-->
                        <span><input id="logo" name="logo" type="button" value="HOME"
                                onClick="location.href='/'" /></span>
                        <span><input id="login" name="login" type="button" value="My Page"
                                onClick="location.href='login'" /></span>
                    </form>
                    <br><br>
                </div>
                <div id="title_txt01">Ïû¨ÌÉùÏπòÎ£åÎ•º ÏúÑÌïú</div>
                <div id="title_txt02">ÏúÑÏπòÏ†ïÎ≥¥ Í≤ÄÏÉâ+</div>
            </div>
        </div>
    </header>

    <br>

    <main>
        <section>
            <div class="ChoicebtnBlock">
                <!--11-08 ÏÑúÏòÅ : button id Î≥ÄÍ≤Ω-->
                <button type="button" id="hospital" onclick="location.href='searchhospital'">Î≥ëÏõê</button>
                <button type="button" id="pharmacy" onclick="location.href='searchpharmacy'">ÏïΩÍµ≠ / Ìé∏ÏùòÏ†ê</button>
                <button type="button" id="pcrCenter" onclick="location.href='searchpcrCenter'">ÏÑ†Î≥ÑÏßÑÎ£åÏÜå</button>
                <button type="button" id="isolation" onclick="location.href='searchisolation'">Í≤©Î¶¨ÏãúÏÑ§</button>
            </div>
        </section>

        <section>
            <!-- ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ Í¥ÄÎ†® ÏûêÎ∞î Ïä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùº Î∂àÎü¨Ïò§Í∏∞ -->
            <script src="map.js"></script>

            <div class="mapBlock">
                <div id="map" style="width : 100%; height:300px;"></div>
            </div>

            <!--Í≤ÄÏÉâ Î∞î ÏúÑÏπò Î≥ÄÍ≤Ω : ÏßÄÎèÑ ÏúÑ -> ÏßÄÎèÑ Î∞ëÏúºÎ°ú -->
            <div class="searchBlock">
                <!--submit , form Î≥ÄÍ≤Ω-->
                <form action="" method="get">
                    <input id="searchVal" name="search" type="text" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî ">

                    <!--Ïù¥ÎØ∏ÏßÄ ÏÜåÏä§ ÏÇΩÏûÖ  + ÏïµÏª§ ÏÇΩÏûÖ-->
                    <a href="#map"><input id="btnSearch" name="btnSearch" type="image" src="./img/searchICON.png"
                            alt="Í≤ÄÏÉâ"></a>

                </form>
            </div>

            <script>
                function indexSubmit() {
                    $.ajax({
                        data: { sOrt: jsonn },
                        async: false,
                        sucess: function (data) {
                            console.log("index submit success!!");
                        },
                        error: function (requrest, status, error) {
                            console.log(error);
                        }
                    });
                    location.href = 'searchpharmacy_distance';


                }

                function getDistanceFromLatLonInKm(lat1, lng1, lat2, lng2) {
                    function deg2rad(deg) {
                        return deg * (Math.PI / 180)
                    }

                    var R = 6371; // Radius of the earth in km
                    var dLat = deg2rad(lat2 - lat1);  // deg2rad below
                    var dLon = deg2rad(lng2 - lng1);
                    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
                    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                    var d = R * c; // Distance in km
                    return d;
                }


                function sortWay() {
                    var flag = true;
                    sortIndex = [];
                    jsonn = [];



                    var sortSelect = document.getElementById("arrayhsp");
                    var selectedWay = sortSelect.options[sortSelect.selectedIndex].value;

                    if (selectedWay == "ganada") {
                        location.href = "searchpharmacy";

                    } else if (selectedWay == "distance") {
                        var dist = [];

                        <% for (var k = 0; k < model.length; k++) { %>
                            var i = <%= k %>;
                            var wid = <%= model[k].ÏúÑÎèÑ %>;
                            var gyd = <%= model[k].Í≤ΩÎèÑ%>;

                            //var Wdist = Math.abs(mePosW-wid);
                            //var Gdist = Math.abs(mePosG-gyd);

                            var ddist = getDistanceFromLatLonInKm(mePosW, mePosG, wid, gyd);

                            console.log(mePosW, mePosG, wid, gyd);
                            dist.push([ddist, <%= model[k].id %>]);
                        <% } %>

                            dist.sort();
                        console.log(dist);

                        for (var i = 0; i < dist.length; i++) {
                            sortIndex[i] = dist[i][1];
                        }
                    }

                    for (var i = 0; i < dist.length; i++) {
                        jsonn.push({
                            dist: dist[i][0],
                            index: dist[i][1]
                        });
                    }

                    indexSubmit();

                }



            </script>
            <div class="arrayBlcok">
                <select name="arrayhsp" id="arrayhsp" onchange="sortWay()">
                    <span>
                        <option value="ganada">Í∞ÄÎÇòÎã§ Ïàú</option>
                    </span>
                    <span>
                        <option value="distance" selected>Í∞ÄÍπåÏö¥ Ïàú</option>
                    </span>
                </select>
                <form>
                    <!-- Î≤ÑÌäº ÏïÑÏù¥Îîî ÏÇΩÏûÖ 2022 11 07 ÍπÄÏú†ÏßÑ ÏàòÏ†ï -->
                    <span><input id="b1" name="location" type="button" value="ÌòÑÏû¨ ÏúÑÏπò "></span>
                </form>
            </div>
            <div class="resBlock">
                <script>

                    function savewg(hpName, wido, gyeongdo) {
                        hp = hpName;
                        wid = wido;
                        gyd = gyeongdo;

                        var loc = new naver.maps.LatLng(wid, gyd); // ÎàÑÎ•∏Î≤ÑÌäºÏùò ÏúÑÎèÑ Í≤ΩÎèÑ
                        map.setCenter(loc); // ÏñªÏùÄ Ï¢åÌëúÎ•º ÏßÄÎèÑÏùò Ï§ëÏã¨ÏúºÎ°ú ÏÑ§Ï†ïÌï©ÎãàÎã§.
                        map.setZoom(17);
                        var contentString = [
                            '<div class="iw_inner">',
                            '   <h3>' + hp + '</h3>',
                            '</div>'
                        ].join('');

                        var infowindow = new naver.maps.InfoWindow({ // Ï†ïÎ≥¥Ï∞Ω ÎùÑÏúÑÍ∏∞
                            content: contentString
                        });


                        var marker = new naver.maps.Marker({
                            position: new naver.maps.LatLng(wid, gyd),
                            map: map
                        });

                        infowindow.open(map, marker);

                        naver.maps.Event.addListener(marker, "click", function (e) {
                            if (infowindow.getMap()) {
                                infowindow.close();
                            } else {
                                infowindow.open(map, marker);
                            }
                        })

                    }


                </script>
                <form>
                    <ul id="reslist">
                        <% for(var i=0; i<model.length; i++){ %>
                            <li id=<%=model[i].id %> onclick='savewg("<%= model[i].ÏóÖÏ≤¥Î™Ö%>",<%= model[i].ÏúÑÎèÑ %>,<%=
                                            model[i].Í≤ΩÎèÑ %>)'>
                                            <div>
                                                <img id="img" name="ÏÇ¨ÏßÑ" alt="ÏÇ¨ÏßÑ" src="./img/pharmacy.jpg">
                                            </div>
                                            <div class="inform">
                                                <span id="name">
                                                    <%= model[i].ÏóÖÏ≤¥Î™Ö %>
                                                </span>
                                                <span id="tel"> |
                                                    <%= model[i].Ï†ÑÌôîÎ≤àÌò∏ %>
                                                </span>
                                                <span id="address">
                                                    <%= model[i].Ï£ºÏÜå %>
                                                </span>

                                                <span class="time">ÌèâÏùº
                                                    <%= model[i].ÌèâÏùºÏö¥ÏòÅÏãúÍ∞Ñ %>
                                                </span>
                                                <span class="time">ÌÜ†ÏöîÏùº
                                                    <%= model[i].ÌÜ†ÏöîÏùºÏö¥ÏòÅÏãúÍ∞Ñ %>
                                                </span>
                                                <span class="time">ÏùºÏöîÏùº
                                                    <%= model[i].ÏùºÏöîÏùºÏö¥ÏòÅÏãúÍ∞Ñ %>
                                                </span>
                                            </div>

                                            <!--ÏòàÏïΩ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÏòàÏïΩ ÌåùÏóÖÏ∞Ω Îú®ÎèÑÎ°ù-->
                                            <a href="#pop1" class="btn"><input type="button" id="btnReserve"
                                                    value="Î∞∞Îã¨ ÏòàÏïΩ"></a>

                                            <!--Í∞ÄÎ†§Ïßà Î∂ÄÎ∂Ñ / opacity : 0-->
                                            <div class="popup" id="pop1">
                                                <span>ÏòàÏïΩ Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî‚úçüèª</span>
                                                <div id="popupform">
                                                    <form>
                                                        <table id="reserveTable">
                                                            <tr class="reserveMyData">
                                                                <td class="popupTableKey">Ïù¥Î¶Ñ</td>
                                                                <td class="popupTableValue"><input type="text"></td>
                                                            </tr>
                                                            <tr class="reserveMyData">
                                                                <td class="popupTableKey">Ïó∞ÎùΩÏ≤ò</td>
                                                                <td class="popupTableValue"><input type="tel"
                                                                        placeholder="">
                                                                </td>
                                                            </tr>
                                                            <tr class="reserveMyData">
                                                                <td class="popupTableKey">Ï£ºÏÜå</td>
                                                                <td class="popupTableValue">
                                                                    <input type="text" placeholder="">
                                                                </td>
                                                            </tr>
                                                            <tr class="reserveHealth">
                                                                <td class="popupTableKey">Ï¶ùÏÉÅ</td>
                                                                <td><textarea class="popupTableValue" id="health"
                                                                        rows="4" placeholder=""></textarea></td>
                                                            </tr>
                                                            <tr class="reserveDate">
                                                                <!--ÎÇ†Ïßú ÏûÖÎ†• Ìèº-->
                                                                <td class="popupTableKey">Ìù¨Îßù ÎÇ†Ïßú</td
                                                                    class="popupTableValue">
                                                                <td><input type="date" class="popupTableValue"
                                                                        id="reserveDate"></td>
                                                                <script>
                                                                    document.getElementById('reserveDate').value = new Date().toISOString().substring(0, 10);
                                                                </script>
                                                                <!--ÌòÑÏû¨ ÎÇ†ÏßúÎ•º Í∏∞Î≥∏Í∞íÏúºÎ°ú-->
                                                            </tr>
                                                            <tr class="reserveDate">
                                                                <!--ÏßÑÎ£å Ìù¨ÎßùÏãúÍ∞Ñ ÏÑ†ÌÉù - ÎùºÎîîÏò§Î≤ÑÌäº-->
                                                                <td class="popupTableKey">Ìù¨Îßù ÏãúÍ∞ÑÎåÄ</td>
                                                                <td><input type="text" placeholder="30Î∂Ñ Îã®ÏúÑÎ°ú ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî :)">
                                                                </td>
                                                            </tr>
                                                        </table>
                                                        <a href="#a"><input id="btnClose" type="button" value="Ï∑®ÏÜå"></a>
                                                        <input id="btnSub" type="submit" value="ÏòàÏïΩÌïòÍ∏∞"
                                                            onclick="btnSub_OnClick()" onClick="location.href='#a'"></a>
                                                        <script>
                                                            function btnSub_OnClick() {
                                                                alert("ÏòàÏïΩÏù¥ Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.");
                                                                window.location.href = "#a";
                                                            }
                                                        </script>
                                                    </form>
                                                </div>
                                            </div>
                                            <div class="dim">
                                            </div>
                                            <!--Ïó¨Í∏∞ÍπåÏßÄ-->
                            </li>
                            <% } %>
                                <p style=clear:both;></p>
                                <!--<span><input name="add" type="button" value="ÎçîÎ≥¥Í∏∞"></span>-->
                </form>
            </div>
        </section>
    </main>

    <footer>
        <!--ÏÇ¨Ïù¥Ìä∏ Ï†ïÎ≥¥-->
        <div class="footer_info">
            <div id="footer-left">
                <div class="footer_title">Project</div>
                <div><img id="logomean" src="./img/logo+mean.png"></div>
                <div>2022-2 Capstone Design</div>
                <div>Project EOUI</div>
            </div>
            <div id="footer-center">
                <div class="footer_title">Program</div>
                <div>Tool | Visual Studio Code</div>
                <div>Front-end | HTML, CSS, JavaScript</div>
                <div>Back-end | Nodejs, SQLite3, jQuery, Express</div>
                <div>UI,UX | Photoshop, Illustrator, Figma</div>
                <div>API | Naver Map</div>
            </div>
            <div id="footer-right">
                <div class="footer_title">Team </div>
                <div>
                    <span><img src="./img/t_go.png"></span>
                    <span>ÎπÖÎç∞Ïù¥ÌÑ∞ 19 Í≥†ÏùÄÏòÅ</span>
                </div>
                <div>
                    <span><img src="./img/t_kim.png"></span>
                    <span>ÎπÖÎç∞Ïù¥ÌÑ∞ 19 ÍπÄÏú†ÏßÑ</span>
                </div>
                <div>
                    <span><img src="./img/t_nam.png"></span>
                    <span>ÏΩòÌÖêÏ∏†IT 19 ÎÇ®ÏÑúÏòÅ</span>
                </div>
            </div>
        </div>
        <div id="footer-bottom">
            @2022-2 Capstone Design Made by Team Homehealer
        </div>
    </footer>
</body>

</html>
